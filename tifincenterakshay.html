<!DOCTYPE html>
<html lang="hi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tiffin Center Enhanced App with Payments & Restaurants</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <style>
    /* ... (Your CSS remains unchanged; omitted for brevity) ... */
  </style>
</head>

<body data-theme="dark">

  <header class="glass" role="banner" aria-label="Header">
    <button id="btnMenu" class="material-icons menu-btn" aria-label="Menu">menu</button>
    <span class="title" tabindex="0">टिफिन सेंटर</span>
    <nav>
      <button id="btnTheme" class="material-icons theme-btn" aria-label="Toggle Light/Dark Theme"
        title="थीम बदलें">dark_mode</button>
    </nav>
  </header>

  <div id="overlay"></div>

  <aside id="sidebar" class="glass closed" aria-label="Navigation Sidebar">
    <nav>
      <button class="nav-btn active" data-section="dashboard" aria-current="page" tabindex="0"><span
          class="material-icons">dashboard</span> डैशबोर्ड</button>
      <button class="nav-btn" data-section="orders" tabindex="0"><span class="material-icons">receipt_long</span> ऑर्डर
        एवं पेमेंट</button>
      <button class="nav-btn" data-section="menu" tabindex="0"><span class="material-icons">restaurant_menu</span>
        मेनू</button>
      <button class="nav-btn" data-section="customers" tabindex="0"><span class="material-icons">people</span>
        ग्राहक</button>
      <button class="nav-btn" data-section="policy" tabindex="0"><span class="material-icons">policy</span> नीति
        (Policy)</button>
      <button class="nav-btn" data-section="settings" tabindex="0"><span class="material-icons">settings</span>
        सेटिंग्स</button>
    </nav>
  </aside>

  <main tabindex="0" role="main" aria-live="polite" aria-atomic="true"></main>

  <footer class="glass" aria-label="Footer">
    © 2024 टिफिन सेंटर | <a href="mailto:support@tiffincenter.in">संपर्क करें</a> | <strong>Invented by Akshay</strong>
  </footer>

  <!-- Modal -->
  <div id="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modalTitle">
    <div class="modal-content">
      <button class="close-btn" aria-label="Close">&times;</button>
      <h2 id="modalTitle"></h2>
      <div id="modalBody"></div>
    </div>
  </div>

  <div id="toast-container" aria-live="assertive" aria-atomic="true" role="region" aria-relevant="additions"></div>

  <script>
    (() => {
      // Helper function for safe JSON parsing with fallback
      function loadFromLocalStorage(key, fallback) {
        try {
          const item = localStorage.getItem(key);
          return item ? JSON.parse(item) : fallback;
        } catch {
          return fallback;
        }
      }

      const body = document.body;
      const btnMenu = document.getElementById('btnMenu');
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('overlay');
      const btnTheme = document.getElementById('btnTheme');
      const navButtons = Array.from(sidebar.querySelectorAll('button.nav-btn'));
      const main = document.querySelector('main');
      const modal = document.getElementById('modal');
      const modalTitle = document.getElementById('modalTitle');
      const modalBody = document.getElementById('modalBody');
      const closeModalBtn = modal.querySelector('.close-btn');
      const toastContainer = document.getElementById('toast-container');

      const restaurants = [
        'Shahi Tiffin House', 'Delight Meals', 'Tiffin Express', 'Fresh Tiffins', 'Royal Tiffins',
        'Quick Bites', 'Foodie’s Tiffin', 'Spice Box', 'Daily Dabba', 'Healthy Meals'
      ];

      let state = {
        theme: localStorage.getItem('theme') || 'dark',
        activeSection: 'dashboard',
        dishes: loadFromLocalStorage('tiffin_dishes', [
          { id: 'd1', name: 'पनीर बटर मसाला', desc: 'नरम पनीर टमाटर की ग्रेवी में', price: 150 },
          { id: 'd2', name: 'जीरा राइस', desc: 'खुशबूदार बासमती चावल', price: 80 },
          { id: 'd3', name: 'मिक्स वेजिटेबल करी', desc: 'मौसमी सब्ज़ियाँ मसाला वाली', price: 120 }
        ]),
        customers: loadFromLocalStorage('tiffin_customers', [
          { id: 'c1', name: 'अमित कुमार', email: 'amit.kumar@example.com', mobile: '9876543210', address: 'दिल्ली, एमजी रोड 123' },
          { id: 'c2', name: 'सोनल शर्मा', email: 'sonal.sharma@example.com', mobile: '9123456780', address: 'कोलकाता, पार्क स्ट्रीट 45' },
          { id: 'c3', name: 'रवि सिंह', email: 'ravi.singh@example.com', mobile: '9812345678', address: 'मुंबई, लिंक रोड' },
          { id: 'c4', name: 'नीता देसाई', email: 'nita.desai@example.com', mobile: '9898989898', address: 'पुणे, हाई स्ट्रीट' },
          { id: 'c5', name: 'साथी कुमारी', email: 'saathi.k@example.com', mobile: '9876541111', address: 'बेंगलुरु, MG रोड' },
          { id: 'c6', name: 'जॉन डो', email: 'john.doe@example.com', mobile: '9876500000', address: 'चंडीगढ़, सेक्टर 5' },
          { id: 'c7', name: 'सोमेश शर्मा', email: 'somesh.sharma@example.com', mobile: '9867123456', address: 'जयपुर, पुष्कर' },
          { id: 'c8', name: 'सुमीता रॉय', email: 'sumita.roy@example.com', mobile: '9876999999', address: 'कोलकाता, फ्लैट 101' },
          { id: 'c9', name: 'अरविंद पटेल', email: 'arvind.patel@example.com', mobile: '9876542222', address: 'अहमदाबाद, गुरुजी रोड' },
          { id: 'c10', name: 'मनीषा जैन', email: 'manisha.jain@example.com', mobile: '9876555555', address: 'इंदौर, शिव नगर' }
        ]),
        orders: loadFromLocalStorage('tiffin_orders', [
          { id: 'o1', customerId: 'c1', restaurant: restaurants[0], amount: 300, paidAmount: 150, status: 'Pending', date: new Date().toISOString() },
          { id: 'o2', customerId: 'c2', restaurant: restaurants[1], amount: 450, paidAmount: 450, status: 'Paid', date: new Date().toISOString() },
          { id: 'o3', customerId: 'c3', restaurant: restaurants[2], amount: 500, paidAmount: 0, status: 'Pending', date: new Date().toISOString() },
          { id: 'o4', customerId: 'c4', restaurant: restaurants[3], amount: 350, paidAmount: 350, status: 'Paid', date: new Date().toISOString() },
          { id: 'o5', customerId: 'c5', restaurant: restaurants[4], amount: 200, paidAmount: 100, status: 'Pending', date: new Date().toISOString() },
          { id: 'o6', customerId: 'c6', restaurant: restaurants[5], amount: 600, paidAmount: 600, status: 'Paid', date: new Date().toISOString() },
          { id: 'o7', customerId: 'c7', restaurant: restaurants[6], amount: 150, paidAmount: 0, status: 'Pending', date: new Date().toISOString() },
          { id: 'o8', customerId: 'c8', restaurant: restaurants[7], amount: 400, paidAmount: 400, status: 'Paid', date: new Date().toISOString() },
          { id: 'o9', customerId: 'c9', restaurant: restaurants[8], amount: 500, paidAmount: 250, status: 'Pending', date: new Date().toISOString() },
          { id: 'o10', customerId: 'c10', restaurant: restaurants[9], amount: 700, paidAmount: 700, status: 'Paid', date: new Date().toISOString() }
        ])
      };

      function saveState() {
        localStorage.setItem('theme', state.theme);
        localStorage.setItem('tiffin_orders', JSON.stringify(state.orders));
        localStorage.setItem('tiffin_dishes', JSON.stringify(state.dishes));
        localStorage.setItem('tiffin_customers', JSON.stringify(state.customers));
      }

      function applyTheme() {
        body.setAttribute('data-theme', state.theme);
      }

      btnTheme.addEventListener('click', () => {
        state.theme = state.theme === 'light' ? 'dark' : 'light';
        applyTheme();
        saveState();
      });
      applyTheme();

      function openSidebar() {
        sidebar.classList.add('open');
        overlay.classList.add('visible');
      }
      function closeSidebar() {
        sidebar.classList.remove('open');
        overlay.classList.remove('visible');
      }
      btnMenu.addEventListener('click', () => sidebar.classList.contains('open') ? closeSidebar() : openSidebar());
      overlay.addEventListener('click', closeSidebar);
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape' && sidebar.classList.contains('open')) closeSidebar();
      });

      navButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          if (btn.classList.contains('active')) {
            btn.classList.remove('active');
            state.activeSection = null;
            closeSidebar();
            main.innerHTML = '<p style="color:#ccc;text-align:center;">कोई अनुभाग चयनित नहीं है। कृपया बायीं ओर से चयन करें।</p>';
            return;
          }
          navButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.activeSection = btn.dataset.section;
          renderSection();
          closeSidebar();
        });
      });

      function showToast(msg, type = 'success') {
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.textContent = msg;
        toast.style.backgroundColor = type === 'error' ? 'var(--danger)' : 'var(--success)';
        toastContainer.appendChild(toast);
        setTimeout(() => toast.remove(), 3500);
        toast.addEventListener('click', () => toast.remove());
      }

      function openModal(title, contentHTML) {
        modalTitle.textContent = title;
        modalBody.innerHTML = contentHTML;
        modal.classList.add('active');
        modal.setAttribute('aria-hidden', 'false');
        modal.focus();
      }
      function closeModal() {
        modal.classList.remove('active');
        modal.setAttribute('aria-hidden', 'true');
      }
      closeModalBtn.addEventListener('click', closeModal);
      modal.addEventListener('click', e => {
        if (e.target === modal) closeModal();
      });

      // ... (rest of your rendering and event-handling logic remains unchanged) ...
      // You can paste your other functions here as in your original file.
    })();
  </script>

</body>
</html>

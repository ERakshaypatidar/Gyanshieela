<!DOCTYPE html>
<html lang="hi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tiffin Center Enhanced App with Payments & Restaurants</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <style>
    /* Reset & base */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    html {
      font-size: 14px;
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      line-height: 1.4;
      min-height: 100vh;
      display: grid;
      grid-template-rows: 50px 1fr 48px;
      overflow: hidden;
      background:
        linear-gradient(rgba(0, 0, 0, 0.45), rgba(0, 0, 0, 0.5)),
        url('https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/b84e1530-2a6e-440b-883e-d5406f8c7999.png') no-repeat center center / cover;
      color: var(--text-primary);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    :root {
      --bg-color: transparent;
      --text-primary: #eee;
      --text-secondary: #ccc;
      --primary: #a5b4fc;
      --primary-dark: #818cf8;
      --danger: #f87171;
      --success: #4ade80;
      --card-bg: rgba(30 30 47 / 0.75);
      --glass-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
      --border-radius: 12px;
      --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    [data-theme='light'] {
      --text-primary: #222;
      --text-secondary: #555;
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --danger: #ef4444;
      --success: #22c55e;
      --card-bg: rgba(255 255 255 / 0.85);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 9px;
    }

    ::-webkit-scrollbar-thumb {
      background-color: var(--primary);
      border-radius: var(--border-radius);
      border: 2px solid transparent;
      background-clip: content-box;
    }

    /* Glass */
    .glass {
      backdrop-filter: saturate(180%) blur(12px);
      background-color: var(--card-bg);
      box-shadow: var(--glass-shadow);
      border-radius: var(--border-radius);
    }

    /* Header */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 12px;
      background: var(--card-bg);
      box-shadow: var(--glass-shadow);
      backdrop-filter: saturate(180%) blur(12px);
      font-weight: 700;
      color: var(--text-primary);
    }

    header .menu-btn,
    header .theme-btn {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--primary);
      cursor: pointer;
      padding: 4px;
    }

    header .title {
      font-size: 1.2rem;
    }

    /* Sidebar */
    #sidebar {
      position: fixed;
      top: 50px;
      left: 0;
      bottom: 48px;
      width: 220px;
      background: var(--card-bg);
      box-shadow: var(--glass-shadow);
      backdrop-filter: saturate(180%) blur(12px);
      overflow-y: auto;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      border-top-right-radius: var(--border-radius);
      border-bottom-right-radius: var(--border-radius);
      z-index: 1000;
      padding-top: 8px;
    }

    #sidebar.open {
      transform: translateX(0);
    }

    #sidebar nav {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    #sidebar nav button {
      background: none;
      border: none;
      width: 100%;
      padding: 10px 16px;
      font-weight: 600;
      font-size: 1rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 16px;
      cursor: pointer;
      border-left: 4px solid transparent;
      transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
      text-align: left;
      border-radius: 0 var(--border-radius) var(--border-radius) 0;
    }

    #sidebar nav button.active,
    #sidebar nav button:hover,
    #sidebar nav button:focus {
      background-color: var(--primary);
      color: var(--text-inverse);
      border-left-color: var(--danger);
      outline: none;
    }

    #sidebar nav button .material-icons {
      font-size: 22px;
    }

    #overlay {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(6px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 900;
    }

    #overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    main {
      margin-top: 50px;
      margin-bottom: 48px;
      padding: 6px 12px 16px 12px;
      overflow-y: auto;
      outline-offset: 2px;
    }

    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 48px;
      background: var(--card-bg);
      box-shadow: var(--glass-shadow);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      color: var(--text-secondary);
      font-size: 0.85rem;
      backdrop-filter: saturate(180%) blur(12px);
      font-weight: 600;
    }

    footer a {
      color: var(--primary);
      text-decoration: none;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--glass-shadow);
      padding: 12px 16px;
      margin-bottom: 16px;
    }

    button.primary {
      background-color: var(--primary);
      border: none;
      color: var(--text-inverse);
      padding: 8px 16px;
      border-radius: var(--border-radius);
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-size: 1rem;
    }

    button.primary:hover,
    button.primary:focus {
      background-color: var(--primary-dark);
      outline: none;
    }

    button.secondary {
      background: none;
      border: 2px solid var(--primary);
      color: var(--primary);
      padding: 6px 12px;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
    }

    button.secondary:hover,
    button.secondary:focus {
      background-color: var(--primary);
      color: var(--text-inverse);
      outline: none;
    }

    button.danger {
      background-color: var(--danger);
      border: none;
      color: var(--text-inverse);
      font-size: 1rem;
      padding: 8px 14px;
      border-radius: var(--border-radius);
    }

    button.danger:hover,
    button.danger:focus {
      background-color: #b91c1c;
      outline: none;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 6px 10px;
      border-radius: var(--border-radius);
      border: 1.5px solid #ccc;
      font-size: 0.9rem;
      outline-offset: 2px;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 5px var(--primary);
      outline: none;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    th,
    td {
      border-bottom: 1px solid rgba(255, 255, 255, 0.15);
      padding: 6px 8px;
      white-space: nowrap;
      color: var(--text-inverse);
    }

    th {
      background: var(--primary);
      font-weight: 600;
      user-select: none;
    }

    tr:hover {
      background-color: var(--primary-dark);
      color: var(--text-inverse);
    }

    .action-buttons button {
      margin-right: 6px;
      font-size: 0.85rem;
    }

    #modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    #modal.active {
      display: flex;
    }

    #modal .modal-content {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 16px 20px;
      width: 90%;
      max-width: 480px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      color: var(--text-inverse);
      font-size: 0.95rem;
    }

    #modal .close-btn {
      position: absolute;
      top: 8px;
      right: 12px;
      font-size: 24px;
      border: none;
      background: none;
      cursor: pointer;
      color: var(--primary);
    }

    #modal .close-btn:hover {
      color: var(--primary-dark);
    }

    /* WhatsApp button style */
    .btn-whatsapp {
      background-color: #25D366;
      color: white;
      border-radius: 50%;
      padding: 8px 12px;
      font-size: 20px;
      cursor: pointer;
      border: none;
      transition: background-color 0.3s ease;
    }

    .btn-whatsapp:hover,
    .btn-whatsapp:focus {
      background-color: #1ebe57;
      outline: none;
    }
  </style>
</head>

<body data-theme="dark">

  <header class="glass" role="banner" aria-label="Header">
    <button id="btnMenu" class="material-icons menu-btn" aria-label="Menu">menu</button>
    <span class="title" tabindex="0">टिफिन सेंटर</span>
    <nav>
      <button id="btnTheme" class="material-icons theme-btn" aria-label="Toggle Light/Dark Theme"
        title="थीम बदलें">dark_mode</button>
    </nav>
  </header>

  <div id="overlay"></div>

  <aside id="sidebar" class="glass closed" aria-label="Navigation Sidebar">
    <nav>
      <button class="nav-btn active" data-section="dashboard" aria-current="page" tabindex="0"><span
          class="material-icons">dashboard</span> डैशबोर्ड</button>
      <button class="nav-btn" data-section="orders" tabindex="0"><span class="material-icons">receipt_long</span> ऑर्डर
        एवं पेमेंट</button>
      <button class="nav-btn" data-section="menu" tabindex="0"><span class="material-icons">restaurant_menu</span>
        मेनू</button>
      <button class="nav-btn" data-section="customers" tabindex="0"><span class="material-icons">people</span>
        ग्राहक</button>
      <button class="nav-btn" data-section="policy" tabindex="0"><span class="material-icons">policy</span> नीति
        (Policy)</button>
      <button class="nav-btn" data-section="settings" tabindex="0"><span class="material-icons">settings</span>
        सेटिंग्स</button>
    </nav>
  </aside>

  <main tabindex="0" role="main" aria-live="polite" aria-atomic="true"></main>

  <footer class="glass" aria-label="Footer">
    © 2024 टिफिन सेंटर | <a href="mailto:support@tiffincenter.in">संपर्क करें</a> | <strong>Invented by Akshay</strong>
  </footer>

  <!-- Modal -->
  <div id="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modalTitle">
    <div class="modal-content">
      <button class="close-btn" aria-label="Close">&times;</button>
      <h2 id="modalTitle"></h2>
      <div id="modalBody"></div>
    </div>
  </div>

  <div id="toast-container" aria-live="assertive" aria-atomic="true" role="region" aria-relevant="additions"></div>

  <script>
    (() => {
      const body = document.body;
      const btnMenu = document.getElementById('btnMenu');
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('overlay');
      const btnTheme = document.getElementById('btnTheme');
      const navButtons = Array.from(sidebar.querySelectorAll('button.nav-btn'));
      const main = document.querySelector('main');
      const modal = document.getElementById('modal');
      const modalTitle = document.getElementById('modalTitle');
      const modalBody = document.getElementById('modalBody');
      const closeModalBtn = modal.querySelector('.close-btn');
      const toastContainer = document.getElementById('toast-container');

      const restaurants = [
        'Shahi Tiffin House', 'Delight Meals', 'Tiffin Express', 'Fresh Tiffins', 'Royal Tiffins',
        'Quick Bites', 'Foodie’s Tiffin', 'Spice Box', 'Daily Dabba', 'Healthy Meals'
      ];

      let state = {
        theme: localStorage.getItem('theme') || 'dark',
        activeSection: 'dashboard',
        dishes: JSON.parse(localStorage.getItem('tiffin_dishes')) || [
          { id: 'd1', name: 'पनीर बटर मसाला', desc: 'नरम पनीर टमाटर की ग्रेवी में', price: 150 },
          { id: 'd2', name: 'जीरा राइस', desc: 'खुशबूदार बासमती चावल', price: 80 },
          { id: 'd3', name: 'मिक्स वेजिटेबल करी', desc: 'मौसमी सब्ज़ियाँ मसाला वाली', price: 120 }
        ],
        customers: JSON.parse(localStorage.getItem('tiffin_customers')) || [
          { id: 'c1', name: 'अमित कुमार', email: 'amit.kumar@example.com', mobile: '9876543210', address: 'दिल्ली, एमजी रोड 123' },
          { id: 'c2', name: 'सोनल शर्मा', email: 'sonal.sharma@example.com', mobile: '9123456780', address: 'कोलकाता, पार्क स्ट्रीट 45' },
          { id: 'c3', name: 'रवि सिंह', email: 'ravi.singh@example.com', mobile: '9812345678', address: 'मुंबई, लिंक रोड' },
          { id: 'c4', name: 'नीता देसाई', email: 'nita.desai@example.com', mobile: '9898989898', address: 'पुणे, हाई स्ट्रीट' },
          { id: 'c5', name: 'साथी कुमारी', email: 'saathi.k@example.com', mobile: '9876541111', address: 'बेंगलुरु, MG रोड' },
          { id: 'c6', name: 'जॉन डो', email: 'john.doe@example.com', mobile: '9876500000', address: 'चंडीगढ़, सेक्टर 5' },
          { id: 'c7', name: 'सोमेश शर्मा', email: 'somesh.sharma@example.com', mobile: '9867123456', address: 'जयपुर, पुष्कर' },
          { id: 'c8', name: 'सुमीता रॉय', email: 'sumita.roy@example.com', mobile: '9876999999', address: 'कोलकाता, फ्लैट 101' },
          { id: 'c9', name: 'अरविंद पटेल', email: 'arvind.patel@example.com', mobile: '9876542222', address: 'अहमदाबाद, गुरुजी रोड' },
          { id: 'c10', name: 'मनीषा जैन', email: 'manisha.jain@example.com', mobile: '9876555555', address: 'इंदौर, शिव नगर' }
        ],
        orders: JSON.parse(localStorage.getItem('tiffin_orders')) || [
          { id: 'o1', customerId: 'c1', restaurant: restaurants[0], amount: 300, paidAmount: 150, status: 'Pending', date: new Date().toISOString() },
          { id: 'o2', customerId: 'c2', restaurant: restaurants[1], amount: 450, paidAmount: 450, status: 'Paid', date: new Date().toISOString() },
          { id: 'o3', customerId: 'c3', restaurant: restaurants[2], amount: 500, paidAmount: 0, status: 'Pending', date: new Date().toISOString() },
          { id: 'o4', customerId: 'c4', restaurant: restaurants[3], amount: 350, paidAmount: 350, status: 'Paid', date: new Date().toISOString() },
          { id: 'o5', customerId: 'c5', restaurant: restaurants[4], amount: 200, paidAmount: 100, status: 'Pending', date: new Date().toISOString() },
          { id: 'o6', customerId: 'c6', restaurant: restaurants[5], amount: 600, paidAmount: 600, status: 'Paid', date: new Date().toISOString() },
          { id: 'o7', customerId: 'c7', restaurant: restaurants[6], amount: 150, paidAmount: 0, status: 'Pending', date: new Date().toISOString() },
          { id: 'o8', customerId: 'c8', restaurant: restaurants[7], amount: 400, paidAmount: 400, status: 'Paid', date: new Date().toISOString() },
          { id: 'o9', customerId: 'c9', restaurant: restaurants[8], amount: 500, paidAmount: 250, status: 'Pending', date: new Date().toISOString() },
          { id: 'o10', customerId: 'c10', restaurant: restaurants[9], amount: 700, paidAmount: 700, status: 'Paid', date: new Date().toISOString() }
        ]
      };

      function saveState() {
        localStorage.setItem('theme', state.theme);
        localStorage.setItem('tiffin_orders', JSON.stringify(state.orders));
      }

      function applyTheme() {
        body.setAttribute('data-theme', state.theme);
      }

      btnTheme.addEventListener('click', () => {
        state.theme = state.theme === 'light' ? 'dark' : 'light';
        applyTheme();
        saveState();
      });
      applyTheme();

      function openSidebar() {
        sidebar.classList.add('open');
        overlay.classList.add('visible');
      }
      function closeSidebar() {
        sidebar.classList.remove('open');
        overlay.classList.remove('visible');
      }
      btnMenu.addEventListener('click', () => sidebar.classList.contains('open') ? closeSidebar() : openSidebar());
      overlay.addEventListener('click', closeSidebar);
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape' && sidebar.classList.contains('open')) closeSidebar();
      });

      navButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          if (btn.classList.contains('active')) {
            btn.classList.remove('active');
            state.activeSection = null;
            closeSidebar();
            main.innerHTML = '<p style="color:#ccc;text-align:center;">कोई अनुभाग चयनित नहीं है। कृपया बायीं ओर से चयन करें।</p>';
            return;
          }
          navButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.activeSection = btn.dataset.section;
          renderSection();
          closeSidebar();
        });
      });

      function showToast(msg, type = 'success') {
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.textContent = msg;
        toast.style.backgroundColor = type === 'error' ? 'var(--danger)' : 'var(--success)';
        toastContainer.appendChild(toast);
        setTimeout(() => toast.remove(), 3500);
        toast.addEventListener('click', () => toast.remove());
      }

      function openModal(title, contentHTML) {
        modalTitle.textContent = title;
        modalBody.innerHTML = contentHTML;
        modal.classList.add('active');
        modal.setAttribute('aria-hidden', 'false');
        modal.focus();
      }
      function closeModal() {
        modal.classList.remove('active');
        modal.setAttribute('aria-hidden', 'true');
      }
      closeModalBtn.addEventListener('click', closeModal);
      modal.addEventListener('click', e => {
        if (e.target === modal) closeModal();
      });

      function renderDashboard() {
        const orderCount = state.orders.length;
        const pendingCount = state.orders.filter(o => o.status === 'Pending').length;
        const customerCount = state.customers.length;
        const dishCount = state.dishes.length;
        const maxCount = Math.max(orderCount, pendingCount, customerCount, dishCount, 10);
        const barWidth = c => Math.max(10, (c / maxCount) * 70);
        return `
      <div class="card" tabindex="0">
        <h1>डैशबोर्ड</h1>
        <div class="chart-container" aria-label="डेटा सांख्यिकी">
          <div class="chart-bar" tabindex="0">
            <span class="chart-label" id="orders_label">कुल ऑर्डर</span>
            <div class="chart-bar-visual" style="width:${barWidth(orderCount)}%" aria-labelledby="orders_label">${orderCount}</div>
            <span class="chart-value">${orderCount}</span>
          </div>
          <div class="chart-bar" tabindex="0">
            <span class="chart-label" id="pending_label">लंबित ऑर्डर</span>
            <div class="chart-bar-visual pending" style="width:${barWidth(pendingCount)}%" aria-labelledby="pending_label">${pendingCount}</div>
            <span class="chart-value">${pendingCount}</span>
          </div>
          <div class="chart-bar" tabindex="0">
            <span class="chart-label" id="customer_label">ग्राहक</span>
            <div class="chart-bar-visual" style="width:${barWidth(customerCount)}%" aria-labelledby="customer_label">${customerCount}</div>
            <span class="chart-value">${customerCount}</span>
          </div>
          <div class="chart-bar" tabindex="0">
            <span class="chart-label" id="dish_label">मेनू आइटम</span>
            <div class="chart-bar-visual" style="width:${barWidth(dishCount)}%" aria-labelledby="dish_label">${dishCount}</div>
            <span class="chart-value">${dishCount}</span>
          </div>
        </div>
      </div>
    `;
      }

      function renderOrders() {
        const rows = state.orders.map(o => {
          const cust = state.customers.find(c => c.id === o.customerId);
          const custName = cust ? cust.name : 'अनजान';
          const custMobile = cust ? cust.mobile : '';
          const restaurant = o.restaurant;
          const balance = o.amount - o.paidAmount;
          return `<div class="card" tabindex="0" style="position:relative;">
        <h3>ऑर्डर ID: ${o.id}</h3>
        <p><strong>ग्राहक:</strong> ${custName}</p>
        <p><strong>रेस्तरांट:</strong> ${restaurant}</p>
        <p><strong>कुल राशि:</strong> ₹${o.amount}, <strong>भुगतान किया:</strong> ₹${o.paidAmount}</p>
        <p><strong>बकाया:</strong> ₹${balance}</p>
        <label for="status_${o.id}">स्थिति:</label>
        <select id="status_${o.id}" data-id="${o.id}" class="status-change" aria-label="ऑर्डर ${o.id} की स्थिति">
          <option value="Pending" ${o.status === 'Pending' ? 'selected' : ''}>लंबित</option>
          <option value="Preparing" ${o.status === 'Preparing' ? 'selected' : ''}>तैयार</option>
          <option value="Delivered" ${o.status === 'Delivered' ? 'selected' : ''}>डिलीवर</option>
          <option value="Cancelled" ${o.status === 'Cancelled' ? 'selected' : ''}>रद्द</option>
          <option value="Paid" ${o.status === 'Paid' ? 'selected' : ''}>भुगतान पूरा</option>
          <option value="Partial" ${o.status === 'Partial' ? 'selected' : ''}>अधूरा भुगतान</option>
        </select>
        <div style="margin-top:8px;">
          ${balance > 0 ? `<button class="primary pay-btn" data-id="${o.id}" data-balance="${balance}">₹${balance} भुगतान करें</button>` : '<span style="color:var(--success);font-weight:bold;">भुगतान पूरा</span>'}
          <button class="secondary edit-btn" data-id="${o.id}">संपादित करें</button>
          <button class="danger delete-btn" data-id="${o.id}">हटाएं</button>
          ${custMobile ? `<button class="btn-whatsapp" aria-label="व्हाट्सएप ${custName}" onclick="whatsappMessage('${custMobile}')"><span class="material-icons">whatsapp</span></button>` : ''}
        </div>
      </div>`;
        }).join('');
        main.innerHTML = `
      <button class="primary" id="btnAddOrder">नया ऑर्डर जोड़ें</button>
      ${rows || '<p>कोई ऑर्डर नहीं।</p>'}`;
        setTimeout(() => {
          document.getElementById('btnAddOrder')?.addEventListener('click', openAddOrderModal);
          document.querySelectorAll('.status-change').forEach(sel => sel.addEventListener('change', e => {
            const id = e.target.dataset.id, newStatus = e.target.value, order = state.orders.find(o => o.id === id);
            if (order) { order.status = newStatus; saveState(); showToast(`ऑर्डर ${id} की स्थिति "${newStatus}" अपडेट हुई।`); }
          }));
          document.querySelectorAll('.pay-btn').forEach(btn => btn.addEventListener('click', e => {
            openPaymentModal(e.target.dataset.id, parseInt(e.target.dataset.balance, 10));
          }));
          document.querySelectorAll('.edit-btn').forEach(btn => btn.addEventListener('click', e => alert('ऑर्डर संपादन जल्द उपलब्ध होगा।')));
          document.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', e => {
            const id = e.target.dataset.id;
            if (confirm('क्या आप इस ऑर्डर को हटाना चाहते हैं?')) {
              state.orders = state.orders.filter(o => o.id !== id);
              saveState();
              renderSection();
              showToast('ऑर्डर हटाया गया');
            }
          }));
        }, 0);
      }
      window.whatsappMessage = mobile => {
        const msg = encodeURIComponent("नमस्ते, आपका टिफिन सेंटर ऑर्डर अपडेट किया गया है। धन्यवाद!");
        window.open(`https://wa.me/+91${mobile}?text=${msg}`, '_blank');
      };
      function openPaymentModal(orderId, balance) {
        openModal('भुगतान जोड़ें', `
      <p>ऑर्डर ID: ${orderId}</p>
      <p>बकाया ₹${balance}</p>
      <label for="paymentAmt">भुगतान राशि दर्ज करें</label>
      <input type="number" id="paymentAmt" min="1" max="${balance}" value="${balance}" />
      <div style="text-align:right; margin-top:8px;">
        <button class="secondary" id="cancelPay">रद्द करें</button>
        <button class="primary" id="confirmPay">भुगतान करें</button>
      </div>
    `);
        setTimeout(() => {
          document.getElementById('cancelPay').addEventListener('click', closeModal);
          document.getElementById('confirmPay').addEventListener('click', () => {
            const amt = parseInt(document.getElementById('paymentAmt').value, 10);
            if (isNaN(amt) || amt < 1 || amt > balance) { alert('सही राशि दर्ज करें'); return; }
            const order = state.orders.find(o => o.id === orderId);
            if (order) {
              order.paidAmount += amt;
              if (order.paidAmount >= order.amount) {
                order.status = 'Paid';
                order.paidAmount = order.amount;
              }
              else if (order.paidAmount < order.amount) {
                order.status = 'Partial';
              }
              saveState();
              showToast(`₹${amt} भुगतान सफल!`);
              closeModal();
              renderSection();
            }
          });
        }, 0);
      }

      // Other sections: menu, customers, policy, settings simplified for brevity, include whatsapp in customers & menu

      function renderMenu() {
        const menuHTML = state.dishes.map(d => `
      <div class="card" tabindex="0" style="display:flex;gap:12px;align-items:center;">
        <div style="width:80px;height:60px;background:#555;display:flex;align-items:center;justify-content:center;color:#fff;border-radius:8px;font-weight:bold;font-size:0.9rem;">IMG</div>
        <div style="flex-grow:1;">
          <h2>${d.name}</h2>
          <p>${d.desc}</p>
          <p>₹${d.price}</p>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px;">
          <button class="primary" data-id="${d.id}" onclick="editDish(event)">संपादित करें</button>
          <button class="danger" data-id="${d.id}" onclick="deleteDish(event)">हटाएं</button>
          <button class="btn-whatsapp" aria-label="व्हाट्सएप से ऑर्डर करें ${d.name}" onclick="whatsappMessage('9876543210')"><span class="material-icons">whatsapp</span></button>
        </div>
      </div>
    `).join('');
        main.innerHTML = `<button class="primary" id="btnAddDish">नई डिश जोड़ें</button>${menuHTML || '<p>कोई डिश नहीं।</p>'}`;
        setTimeout(() => document.getElementById('btnAddDish')?.addEventListener('click', openAddDishModal), 0);
      }

      function renderCustomers() {
        const customerHTML = state.customers.map(c => `
      <div class="card" tabindex="0" style="display:flex;justify-content:space-between;align-items:center;">
        <div>
          <h2>${c.name}</h2>
          <p><a href="mailto:${c.email}" style="color:var(--primary);text-decoration:underline;">${c.email}</a></p>
          <p><a href="tel:${c.mobile}" style="color:var(--primary);text-decoration:underline;">${c.mobile}</a></p>
          <p>${c.address}</p>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px;">
          <button class="primary" data-id="${c.id}" onclick="editCustomer(event)">संपादित करें</button>
          <button class="danger" data-id="${c.id}" onclick="deleteCustomer(event)">हटाएं</button>
          <button class="btn-whatsapp" aria-label="व्हाट्सएप भेजें ${c.name}" onclick="whatsappMessage('${c.mobile}')"><span class="material-icons">whatsapp</span></button>
        </div>
      </div>
    `).join('');
        main.innerHTML = `<button class="primary" id="btnAddCustomer">नया ग्राहक जोड़ें</button>${customerHTML || '<p>कोई ग्राहक नहीं।</p>'}`;
        setTimeout(() => document.getElementById('btnAddCustomer')?.addEventListener('click', openAddCustomerModal), 0);
      }

      function renderPolicy() {
        return `<div class="card" tabindex="0" style="line-height:1.5;text-align:justify;"><h1>प्राइवेसी और उपयोग नीति</h1><p>यह टिफिन सेंटर ऐप आपकी गोपनीयता का ध्यान रखता है। आपकी जानकारी सुरक्षित है।</p><p>अधिक जानकारी के लिए support@tiffincenter.in पर संपर्क करें।</p></div>`;
      }

      function renderSettings() {
        return `<div class="card"><h2>थीम स्विच करें</h2><button class="primary" id="btnThemeSwitch">थीम बदलें</button></div><div class="card"><h2>ऐप जानकारी</h2><p>टिफिन सेंटर ऐप 2024 में Akshay द्वारा विकसित।</p></div>`;
      }

      function addListenerSettings() {
        document.getElementById('btnThemeSwitch')?.addEventListener('click', () => {
          state.theme = state.theme === 'light' ? 'dark' : 'light';
          applyTheme();
          saveState();
        });
      }

      function openAddOrderModal() { openModal('नया ऑर्डर', '<p>जल्द ही जोड़ा जाएगा।</p>'); }
      function openAddDishModal() { openModal('नई डिश', '<p>जल्द ही जोड़ा जाएगा।</p>'); }
      function openAddCustomerModal() { openModal('नया ग्राहक', '<p>जल्द ही जोड़ा जाएगा।</p>'); }

      function renderSection() {
        switch (state.activeSection) {
          case 'dashboard': main.innerHTML = renderDashboard(); break;
          case 'orders': renderOrders(); break;
          case 'menu': renderMenu(); break;
          case 'customers': renderCustomers(); break;
          case 'policy': main.innerHTML = renderPolicy(); break;
          case 'settings': main.innerHTML = renderSettings(); addListenerSettings(); break;
          default: main.innerHTML = '<p style="color:#ccc;text-align:center;">कोई अनुभाग चयनित नहीं है। कृपया बायीं ओर से चयन करें।</p>';
        }
      }

      renderSection();

      window.editOrder = e => alert('ऑर्डर संपादन जल्द उपलब्ध होगा।');
      window.deleteOrder = e => {
        const id = e.target.dataset.id;
        if (confirm('क्या आप इस ऑर्डर को हटाना चाहते हैं?')) {
          state.orders = state.orders.filter(o => o.id !== id);
          saveState();
          renderSection();
          showToast('ऑर्डर हटाया गया');
        }
      };
      window.editDish = e => alert('डिश संपादन जल्द उपलब्ध होगा।');
      window.deleteDish = e => {
        const id = e.target.dataset.id;
        if (confirm('क्या आप इस डिश को हटाना चाहते हैं?')) {
          state.dishes = state.dishes.filter(d => d.id !== id);
          saveState();
          renderSection();
          showToast('डिश हटाई गई');
        }
      };
      window.editCustomer = e => alert('ग्राहक संपादन जल्द उपलब्ध होगा।');
      window.deleteCustomer = e => {
        const id = e.target.dataset.id;
        if (confirm('क्या आप इस ग्राहक को हटाना चाहते हैं?')) {
          state.customers = state.customers.filter(c => c.id !== id);
          saveState();
          renderSection();
          showToast('ग्राहक हटाया गया');
        }
      };

      window.whatsappMessage = mobile => {
        const msg = encodeURIComponent("नमस्ते, आपका टिफिन सेंटर ऑर्डर अपडेट किया गया है। धन्यवाद!");
        window.open(`https://wa.me/+91${mobile}?text=${msg}`, '_blank');
      };
    })();
  </script>

</body>

</html>
